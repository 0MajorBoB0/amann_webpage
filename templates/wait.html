{% extends "base.html" %}
{% block content %}
<p>Danke! Warte, bis alle entschieden haben …</p>
<p class="mono">Runde {{ round_number }} / {{ session['rounds'] }}</p>
<div class="notice" id="status">Eingänge: {{ decided }}/{{ session['group_size'] }}</div>
<div class="notice" id="list">Entschieden: –</div>
{% endblock %}
{% block scripts %}
<script>
const sid = "{{ session['id'] }}";
const r   = {{ round_number }};
const total = {{ session['group_size'] }};

async function poll(){
  const res = await fetch(`/round_status?session_id=${sid}&round=${r}`);
  if(!res.ok) return;
  const d = await res.json();
  document.getElementById('status').textContent = `Eingänge: ${d.decided}/${total}`;
  const names = (d.decided_players || []).map(n => `<span class="kbd mono">Spieler ${n}</span>`).join(' ');
  document.getElementById('list').innerHTML = `Entschieden: ${names || "–"}`;
  if (d.ready) window.location.href = "/reveal";
}
setInterval(poll, 1000); poll();
</script>
{% endblock %}
